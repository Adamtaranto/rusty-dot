name: Citation CFF

on:
  push:
    paths:
      - CITATION.cff
    tags:
      # Match semantic version tags: v1.0.0, v1.2.3, v2.0.0-beta, etc.
      # Excludes moving tags: v1, v2
      - "v[0-9]+.[0-9]+.[0-9]+*"
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  validate:
    name: Validate CITATION.cff
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6
      - name: Validate CITATION.cff
        uses: dieghernan/cff-validator@v4
        env:
          GITHUB_PAT: ${{ secrets.GITHUB_TOKEN }}

  update:
    name: Update CITATION.cff
    runs-on: ubuntu-latest
    needs: validate
    if: startsWith(github.ref, 'refs/tags/v')
    steps:
      - name: Checkout
        uses: actions/checkout@v6
        with:
          fetch-depth: 0
      - name: Sync version and date in CITATION.cff
        uses: Adamtaranto/citation-sync-action@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          # Create PR instead of pushing to main
          use-pull-request: true
          update-mode: "match"
